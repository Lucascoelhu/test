<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Planograma Corredor</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<style>
    :root {
        --primary: #2c3e50;
        --accent: #2980b9;
        --bg: #ecf0f1;
        --gondola-bg: #fff;
        --shelf-border: #7f8c8d;
        --header-h: 50px;
        --footer-h: 130px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg); 
        margin: 0; padding: 0; 
        height: 100vh;
        overflow: hidden; /* Evita rolagem da página inteira, apenas do corredor */
        display: flex; flex-direction: column;
    }

    /* --- Cabeçalho --- */
    header {
        height: var(--header-h);
        background: var(--primary); color: white; padding: 0 15px;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        flex-shrink: 0;
    }
    h1 { margin: 0; font-size: 1rem; font-weight: 600; }
    .header-btns button {
        background: rgba(255,255,255,0.2); border: none; color: white;
        padding: 6px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left:5px;
    }

    /* --- O CORREDOR (Container Horizontal) --- */
    #aisle-container {
        flex: 1; /* Ocupa o espaço restante entre header e footer */
        display: flex; /* Lado a lado */
        flex-direction: row;
        overflow-x: auto; /* Rolagem horizontal */
        overflow-y: hidden;
        padding: 10px;
        gap: 5px; /* Espaço pequeno entre gôndolas */
        align-items: flex-start;
        background-image: linear-gradient(#ddd 1px, transparent 1px);
        background-size: 20px 20px; /* Efeito de grade de fundo */
    }

    /* --- Módulo da Gôndola --- */
    .gondola {
        background: var(--gondola-bg);
        width: 300px; /* Largura fixa para cada módulo */
        min-width: 300px;
        height: 100%; /* Ocupa altura disponível */
        border: 1px solid #999;
        border-top: 4px solid #555; /* Topo da estante */
        display: flex; flex-direction: column;
        box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        position: relative;
    }
    
    .gondola-header {
        text-align: center; font-size: 12px; color: #fff; 
        background: #7f8c8d; padding: 4px;
        display: flex; justify-content: space-between; align-items: center;
        padding: 4px 10px;
    }
    .btn-del-gondola { background:none; border:none; color:#ffaaaa; font-weight:bold; font-size:14px;}

    /* --- Prateleiras --- */
    .shelf-area {
        flex: 1;
        display: flex; flex-direction: column;
        justify-content: space-evenly; /* Distribui prateleiras uniformemente */
        padding-bottom: 10px;
    }

    .shelf {
        background: #fff;
        border-bottom: 8px solid #bdc3c7; /* Frente da prateleira */
        border-top: 1px solid #eee;
        height: 75px; /* Altura fixa da prateleira */
        display: flex;
        align-items: flex-end; /* Produtos no chão da prateleira */
        padding: 0 4px;
        margin: 0 5px;
        position: relative;
    }
    /* Sombra interna para profundidade */
    .shelf::before {
        content: ''; position: absolute; top:0; left:0; right:0; height: 10px;
        background: linear-gradient(to bottom, rgba(0,0,0,0.1), transparent);
        pointer-events: none;
    }

    /* --- Produtos --- */
    .product {
        width: 45px; height: 45px;
        margin: 0 2px;
        border-radius: 2px;
        display: flex; align-items: center; justify-content: center;
        flex-shrink: 0;
        position: relative;
        box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        cursor: pointer;
        font-size: 9px; line-height: 1.1;
        text-align: center; color: #fff; 
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.1);
    }
    .prod-label { pointer-events: none; padding:1px; }

    /* --- Paleta Fixa --- */
    #palette-container {
        height: var(--footer-h);
        background: #fff;
        border-top: 2px solid #ccc;
        display: flex; flex-direction: column;
        z-index: 100;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }
    .palette-header {
        padding: 5px 10px; background: #f4f4f4; font-size: 12px; color: #555;
        display: flex; justify-content: space-between; align-items: center;
    }
    .btn-add-type {
        background: #27ae60; color: white; border: none; border-radius: 4px;
        padding: 4px 8px; font-size: 11px;
    }

    #palette-scroll {
        flex: 1; overflow-x: auto;
        display: flex; align-items: center; gap: 8px; padding: 0 10px;
    }
    #palette-scroll .product { 
        width: 55px; height: 55px; margin-bottom: 0; flex-shrink: 0;
    }

    /* --- Modais --- */
    .modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.6);
        display: none; justify-content: center; align-items: center; z-index: 2000;
    }
    .modal-box {
        background: #fff; padding: 15px; border-radius: 6px; width: 85%; max-width: 300px;
        text-align: center;
    }
    .modal-box input { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ccc; }
    .modal-btns { display: flex; gap: 10px; justify-content: center; margin-top: 10px;}
    .modal-btns button { flex:1; padding: 8px; border: none; border-radius: 4px; cursor: pointer; color:#fff;}
    
    .ghost { opacity: 0.4; background: #aaa !important; }
</style>
</head>
<body>

<header>
    <h1>Mercado: Vista Corredor</h1>
    <div class="header-btns">
        <button onclick="addGondola()">+ Módulo</button>
        <button onclick="resetPlanogram()" style="background:#c0392b">Limpar</button>
    </div>
</header>

<div id="aisle-container">
    </div>

<div id="palette-container">
    <div class="palette-header">
        <b>Produtos</b> (Arraste para a prateleira)
        <button class="btn-add-type" onclick="openNewTypeModal()">+ Criar Item</button>
    </div>
    <div id="palette-scroll">
        <div class="product" style="background:#c0392b" data-color="#c0392b" data-name="Cola"><span class="prod-label">Cola</span></div>
        <div class="product" style="background:#2980b9" data-color="#2980b9" data-name="Leite"><span class="prod-label">Leite</span></div>
        <div class="product" style="background:#f39c12" data-color="#f39c12" data-name="Suco"><span class="prod-label">Suco</span></div>
        <div class="product" style="background:#27ae60" data-color="#27ae60" data-name="Arroz"><span class="prod-label">Arroz</span></div>
    </div>
</div>

<div id="modalEdit" class="modal-overlay">
    <div class="modal-box">
        <h3>Etiqueta do Produto</h3>
        <input type="text" id="editName" placeholder="Nome do produto">
        <div class="modal-btns">
            <button style="background:#c0392b" onclick="deleteItem()">Excluir</button>
            <button style="background:#2980b9" onclick="saveItem()">Salvar</button>
        </div>
        <button style="background:#ccc; color:#333; margin-top:5px; width:100%; border:none; padding:8px; border-radius:4px" onclick="closeModals()">Cancelar</button>
    </div>
</div>

<div id="modalNew" class="modal-overlay">
    <div class="modal-box">
        <h3>Novo Tipo de Produto</h3>
        <input type="text" id="newTypeName" placeholder="Ex: Sabão em Pó">
        <label style="font-size:12px; display:block; text-align:left">Cor da Embalagem:</label>
        <input type="color" id="newTypeColor" value="#8e44ad" style="height:40px; padding:0">
        <div class="modal-btns">
            <button style="background:#27ae60" onclick="createNewType()">Criar</button>
            <button style="background:#ccc; color:#333" onclick="closeModals()">Cancelar</button>
        </div>
    </div>
</div>

<script>
    const aisle = document.getElementById('aisle-container');
    const paletteScroll = document.getElementById('palette-scroll');
    let currentItem = null;

    /* --- INICIO --- */
    // Configura Paleta
    new Sortable(paletteScroll, {
        group: { name: 'shared', pull: 'clone', put: false },
        sort: false, animation: 150
    });

    loadData();

    /* --- GESTÃO DO LAYOUT --- */
    function loadData() {
        // Carregar Itens Customizados
        const savedPalette = localStorage.getItem('myPalette');
        if(savedPalette) {
            JSON.parse(savedPalette).forEach(p => addPaletteDom(p.name, p.color));
        }

        // Carregar Gôndolas
        const savedGondolas = localStorage.getItem('aisleData');
        aisle.innerHTML = '';
        if(savedGondolas) {
            JSON.parse(savedGondolas).forEach(gData => createGondolaDom(gData.shelves));
        } else {
            // Inicia com 3 gôndolas lado a lado
            createGondolaDom([[],[],[],[],[]]); 
            createGondolaDom([[],[],[],[],[]]);
            createGondolaDom([[],[],[],[],[]]);
        }
    }

    function addGondola() {
        createGondolaDom([[],[],[],[],[]]); // 5 prateleiras vazias
        saveState();
        // Rola o corredor para a direita para ver a nova gôndola
        setTimeout(() => aisle.scrollTo({ left: aisle.scrollWidth, behavior: 'smooth' }), 100);
    }

    function createGondolaDom(shelvesData) {
        const id = document.querySelectorAll('.gondola').length + 1;
        const div = document.createElement('div');
        div.className = 'gondola';
        div.innerHTML = `
            <div class="gondola-header">
                Módulo ${id}
                <button class="btn-del-gondola" onclick="removeGondola(this)">×</button>
            </div>
            <div class="shelf-area"></div>
        `;

        const shelfArea = div.querySelector('.shelf-area');
        
        shelvesData.forEach(items => {
            const shelf = document.createElement('div');
            shelf.className = 'shelf';
            
            items.forEach(item => {
                shelf.appendChild(createProductDom(item.name, item.color));
            });

            shelfArea.appendChild(shelf);

            // Sortable na prateleira
            new Sortable(shelf, {
                group: 'shared',
                animation: 150,
                ghostClass: 'ghost',
                onAdd: (evt) => {
                    const el = evt.item;
                    // Atualiza visual e eventos ao soltar
                    el.style.background = el.dataset.color;
                    el.innerHTML = `<span class="prod-label">${el.dataset.name}</span>`;
                    el.onclick = () => openEdit(el);
                    saveState();
                },
                onUpdate: () => saveState(),
                onRemove: () => saveState()
            });
        });

        aisle.appendChild(div);
    }

    function removeGondola(btn) {
        if(confirm("Remover este módulo?")) {
            btn.closest('.gondola').remove();
            saveState();
        }
    }

    /* --- PRODUTOS --- */
    function createProductDom(name, color) {
        const el = document.createElement('div');
        el.className = 'product';
        el.style.background = color;
        el.dataset.name = name;
        el.dataset.color = color;
        el.innerHTML = `<span class="prod-label">${name}</span>`;
        el.onclick = () => openEdit(el);
        return el;
    }

    function addPaletteDom(name, color) {
        const el = createProductDom(name, color);
        el.onclick = null; // Paleta não edita
        paletteScroll.appendChild(el);
    }

    /* --- MODAIS --- */
    function openEdit(el) {
        currentItem = el;
        document.getElementById('editName').value = el.dataset.name;
        document.getElementById('modalEdit').style.display = 'flex';
    }

    function saveItem() {
        if(currentItem) {
            const newName = document.getElementById('editName').value;
            currentItem.dataset.name = newName;
            currentItem.querySelector('.prod-label').innerText = newName;
            saveState();
        }
        closeModals();
    }

    function deleteItem() {
        if(currentItem) currentItem.remove();
        saveState();
        closeModals();
    }

    function openNewTypeModal() {
        document.getElementById('newTypeName').value = '';
        document.getElementById('modalNew').style.display = 'flex';
    }

    function createNewType() {
        const name = document.getElementById('newTypeName').value || 'Item';
        const color = document.getElementById('newTypeColor').value;
        addPaletteDom(name, color);

        // Salva paleta
        const list = JSON.parse(localStorage.getItem('myPalette') || '[]');
        list.push({name, color});
        localStorage.setItem('myPalette', JSON.stringify(list));
        
        closeModals();
    }

    function closeModals() {
        document.querySelectorAll('.modal-overlay').forEach(m => m.style.display='none');
        currentItem = null;
    }

    /* --- SAVE --- */
    function saveState() {
        const data = [];
        document.querySelectorAll('.gondola').forEach(g => {
            const sData = [];
            g.querySelectorAll('.shelf').forEach(s => {
                const pData = [];
                s.querySelectorAll('.product').forEach(p => {
                    pData.push({ name: p.dataset.name, color: p.dataset.color });
                });
                sData.push(pData);
            });
            data.push({ shelves: sData });
        });
        localStorage.setItem('aisleData', JSON.stringify(data));
    }

    function resetPlanogram() {
        if(confirm("Limpar todo o corredor?")) {
            localStorage.removeItem('aisleData');
            location.reload();
        }
    }
</script>
</body>
</html>
